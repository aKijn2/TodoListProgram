<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:Todo_asa.ViewModels"
             xmlns:models="clr-namespace:Todo_asa.Models"
             x:Class="Todo_asa.Pages.TaskDetailPage"
             x:DataType="viewmodels:TaskDetailViewModel"
             Title="{Binding Title}"
             BackgroundColor="{StaticResource PageBackgroundColor}">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">
            
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- TASK TITLE INPUT                                         -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <VerticalStackLayout Spacing="8">
                <Label Text="Title" 
                       FontSize="13" 
                       FontAttributes="Bold"
                       TextColor="{StaticResource PrimaryLight}"/>
                <Border BackgroundColor="{StaticResource GlassColor}"
                        StrokeShape="RoundRectangle 14"
                        Stroke="{StaticResource BorderColor}"
                        StrokeThickness="1"
                        Padding="16,12">
                    <Entry Text="{Binding TaskTitle}"
                           Placeholder="Enter task title..."
                           PlaceholderColor="{StaticResource PlaceholderColor}"
                           TextColor="{StaticResource PrimaryTextColor}"
                           FontSize="17"
                           FontAttributes="Bold"
                           BackgroundColor="Transparent"/>
                </Border>
            </VerticalStackLayout>
            
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- DESCRIPTION INPUT                                        -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <VerticalStackLayout Spacing="8">
                <Label Text="Description" 
                       FontSize="13" 
                       FontAttributes="Bold"
                       TextColor="{StaticResource PrimaryLight}"/>
                <Border BackgroundColor="{StaticResource GlassColor}"
                        StrokeShape="RoundRectangle 14"
                        Stroke="{StaticResource BorderColor}"
                        StrokeThickness="1"
                        Padding="16,12"
                        MinimumHeightRequest="100">
                    <Editor Text="{Binding Description}"
                            Placeholder="Enter description..."
                            PlaceholderColor="{StaticResource PlaceholderColor}"
                            TextColor="{StaticResource PrimaryTextColor}"
                            FontSize="15"
                            AutoSize="TextChanges"
                            BackgroundColor="Transparent"/>
                </Border>
            </VerticalStackLayout>
            
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- STATUS PICKER WITH GRADIENT INDICATOR                    -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <VerticalStackLayout Spacing="8">
                <Label Text="Status" 
                       FontSize="13" 
                       FontAttributes="Bold"
                       TextColor="{StaticResource PrimaryLight}"/>
                <Border BackgroundColor="{StaticResource GlassColor}"
                        StrokeShape="RoundRectangle 14"
                        Stroke="{StaticResource BorderColor}"
                        StrokeThickness="1"
                        Padding="16,8">
                    <Grid ColumnDefinitions="Auto,*">
                        <!-- Status Indicator Dot -->
                        <Border Grid.Column="0" 
                                WidthRequest="12" HeightRequest="12"
                                StrokeShape="RoundRectangle 6"
                                Margin="0,0,12,0"
                                VerticalOptions="Center">
                            <Border.Triggers>
                                <DataTrigger TargetType="Border" Binding="{Binding SelectedStatusIndex}" Value="0">
                                    <Setter Property="Background" Value="{StaticResource ToDoGradient}"/>
                                </DataTrigger>
                                <DataTrigger TargetType="Border" Binding="{Binding SelectedStatusIndex}" Value="1">
                                    <Setter Property="Background" Value="{StaticResource InProgressGradient}"/>
                                </DataTrigger>
                                <DataTrigger TargetType="Border" Binding="{Binding SelectedStatusIndex}" Value="2">
                                    <Setter Property="Background" Value="{StaticResource CompletedGradient}"/>
                                </DataTrigger>
                            </Border.Triggers>
                        </Border>
                        <Picker Grid.Column="1"
                                SelectedIndex="{Binding SelectedStatusIndex}"
                                TextColor="{StaticResource PrimaryTextColor}"
                                BackgroundColor="Transparent">
                            <Picker.ItemsSource>
                                <x:Array Type="{x:Type x:String}">
                                    <x:String>üìù To Do</x:String>
                                    <x:String>‚ö° In Progress</x:String>
                                    <x:String>‚úì Completed</x:String>
                                </x:Array>
                            </Picker.ItemsSource>
                        </Picker>
                    </Grid>
                </Border>
            </VerticalStackLayout>
            
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- DUE DATE SECTION                                         -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <VerticalStackLayout Spacing="8">
                <Label Text="Due Date" 
                       FontSize="13" 
                       FontAttributes="Bold"
                       TextColor="{StaticResource PrimaryLight}"/>
                
                <!-- Toggle Due Date -->
                <Border BackgroundColor="{StaticResource GlassColor}"
                        StrokeShape="RoundRectangle 14"
                        Stroke="Transparent"
                        Padding="12,8">
                    <HorizontalStackLayout Spacing="12">
                        <CheckBox IsChecked="{Binding HasDueDate}"
                                  Color="{StaticResource AccentColor}"/>
                        <Label Text="Set a due date"
                               FontSize="15"
                               TextColor="{StaticResource PrimaryTextColor}"
                               VerticalOptions="Center"/>
                    </HorizontalStackLayout>
                </Border>
                
                <!-- Date Picker (visible when HasDueDate is true) -->
                <Border BackgroundColor="{StaticResource GlassColor}"
                        StrokeShape="RoundRectangle 14"
                        Stroke="{StaticResource BorderGlowColor}"
                        StrokeThickness="1"
                        Padding="16,12"
                        IsVisible="{Binding HasDueDate}">
                    <HorizontalStackLayout Spacing="12">
                        <Label Text="üìÖ" FontSize="20" VerticalOptions="Center"/>
                        <DatePicker Date="{Binding SelectedDueDate}"
                                    MinimumDate="{Binding MinimumDate}"
                                    TextColor="{StaticResource PrimaryTextColor}"
                                    BackgroundColor="Transparent"/>
                    </HorizontalStackLayout>
                </Border>
            </VerticalStackLayout>
            
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- SUBTASKS SECTION                                         -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <VerticalStackLayout Spacing="12">
                <Label Text="Subtasks" 
                       FontSize="13" 
                       FontAttributes="Bold"
                       TextColor="{StaticResource PrimaryLight}"/>
                
                <!-- Add Subtask -->
                <Border BackgroundColor="{StaticResource GlassColor}"
                        StrokeShape="RoundRectangle 14"
                        Stroke="{StaticResource BorderColor}"
                        StrokeThickness="1"
                        Padding="12">
                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                        <Entry Grid.Column="0"
                               Text="{Binding NewSubTaskTitle}"
                               Placeholder="Add a subtask..."
                               PlaceholderColor="{StaticResource PlaceholderColor}"
                               TextColor="{StaticResource PrimaryTextColor}"
                               BackgroundColor="Transparent"
                               ReturnCommand="{Binding AddSubTaskCommand}"/>
                        <!-- Gradient Add Button -->
                        <Border Grid.Column="1"
                                StrokeShape="RoundRectangle 10"
                                Stroke="Transparent"
                                Background="{StaticResource AccentGradient}"
                                Padding="16,8"
                                Shadow="{StaticResource ButtonShadow}">
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding AddSubTaskCommand}"/>
                            </Border.GestureRecognizers>
                            <Label Text="Add" 
                                   TextColor="White" 
                                   FontAttributes="Bold"
                                   FontSize="13"
                                   VerticalOptions="Center"/>
                        </Border>
                    </Grid>
                </Border>
                
                <!-- Subtask List -->
                <VerticalStackLayout BindableLayout.ItemsSource="{Binding SubTasks}" Spacing="8">
                    <BindableLayout.ItemTemplate>
                        <DataTemplate x:DataType="models:SubTaskItem">
                            <Border BackgroundColor="{StaticResource GlassColor}"
                                    StrokeShape="RoundRectangle 12"
                                    Stroke="Transparent"
                                    Padding="12">
                                <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                                    
                                    <!-- Checkbox -->
                                    <CheckBox Grid.Column="0"
                                              IsChecked="{Binding IsCompleted}"
                                              Color="{StaticResource AccentColor}">
                                        <CheckBox.GestureRecognizers>
                                            <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:TaskDetailViewModel}}, Path=ToggleSubTaskCommand}"
                                                                  CommandParameter="{Binding .}"/>
                                        </CheckBox.GestureRecognizers>
                                    </CheckBox>
                                    
                                    <!-- Title -->
                                    <Label Grid.Column="1"
                                           Text="{Binding Title}"
                                           FontSize="15"
                                           TextColor="{StaticResource PrimaryTextColor}"
                                           VerticalOptions="Center">
                                        <Label.Triggers>
                                            <DataTrigger TargetType="Label" Binding="{Binding IsCompleted}" Value="True">
                                                <Setter Property="TextDecorations" Value="Strikethrough"/>
                                                <Setter Property="TextColor" Value="{StaticResource SecondaryTextColor}"/>
                                            </DataTrigger>
                                        </Label.Triggers>
                                    </Label>
                                    
                                    <!-- Delete Button -->
                                    <Border Grid.Column="2"
                                            WidthRequest="28" HeightRequest="28"
                                            StrokeShape="RoundRectangle 8"
                                            BackgroundColor="{StaticResource GlassColor}">
                                        <Border.GestureRecognizers>
                                            <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:TaskDetailViewModel}}, Path=DeleteSubTaskCommand}"
                                                                  CommandParameter="{Binding .}"/>
                                        </Border.GestureRecognizers>
                                        <Label Text="‚úï" 
                                               FontSize="12"
                                               TextColor="{StaticResource SecondaryTextColor}"
                                               VerticalOptions="Center"
                                               HorizontalOptions="Center"/>
                                    </Border>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </VerticalStackLayout>
            </VerticalStackLayout>
            
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- ACTION BUTTONS                                           -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="12" Margin="0,20,0,0">
                <!-- Cancel Button -->
                <Border Grid.Column="0"
                        StrokeShape="RoundRectangle 14"
                        BackgroundColor="{StaticResource GlassColor}"
                        Stroke="{StaticResource BorderColor}"
                        StrokeThickness="1"
                        HeightRequest="50">
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding CancelCommand}"/>
                    </Border.GestureRecognizers>
                    <Label Text="Cancel"
                           TextColor="{StaticResource PrimaryTextColor}"
                           FontAttributes="Bold"
                           VerticalOptions="Center"
                           HorizontalOptions="Center"/>
                </Border>
                
                <!-- Save Button with Gradient -->
                <Border Grid.Column="1"
                        StrokeShape="RoundRectangle 14"
                        Background="{StaticResource AccentGradient}"
                        Stroke="Transparent"
                        HeightRequest="50"
                        Shadow="{StaticResource ButtonShadow}">
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding SaveCommand}"/>
                    </Border.GestureRecognizers>
                    <Label Text="Save"
                           TextColor="White"
                           FontAttributes="Bold"
                           VerticalOptions="Center"
                           HorizontalOptions="Center"/>
                </Border>
            </Grid>
            
            <!-- Delete Button (only for existing tasks) -->
            <Border StrokeShape="RoundRectangle 14"
                    BackgroundColor="#40EF4444"
                    Stroke="{StaticResource DangerColor}"
                    StrokeThickness="1"
                    HeightRequest="50"
                    IsVisible="{Binding IsNewTask, Converter={StaticResource InverseBoolConverter}}">
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding DeleteCommand}"/>
                </Border.GestureRecognizers>
                <HorizontalStackLayout HorizontalOptions="Center" Spacing="8">
                    <Label Text="üóëÔ∏è" FontSize="16" VerticalOptions="Center"/>
                    <Label Text="Delete Task"
                           TextColor="{StaticResource OverdueColor}"
                           FontAttributes="Bold"
                           VerticalOptions="Center"/>
                </HorizontalStackLayout>
            </Border>
            
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
